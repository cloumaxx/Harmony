{% load static %}
<style>
    #btn_dropdown {
        background: none;
        border: none;
    }

    .dropdown-item {
        margin-top: 5px;
    }

    .dropdown-item:hover {
        cursor: pointer;

    }

    #btn_dropdown .dropdown-toggle::after {
        display: none;
    }

    #conText {
        color: white;
        padding-top: 10px;
    }

    #text_button2 {
        color: white;
        font-size: 20px;
    }

    #contComentario {
        border-radius: 17px;
        background: #E9DEB3;
        box-shadow: 0px 4px 4px 0px rgba(0, 0, 0, 0.25);
    }

    #info_user {
        margin-top: 5%;
        border-radius: 45px;
        background: #C8C6C6;
        box-shadow: 0px 4px 4px 0px rgba(0, 0, 0, 0.40);
    }

    #boton_editar {
        width: 80%;
        border-radius: 14px;
        background: #3853FF;
        box-shadow: 0px 4px 4px 0px rgba(0, 0, 0, 0.25);

    }

    #cont_comentarios {
        border-radius: 45px;
        background: #BDB5E7;
        box-shadow: 0px 4px 4px 0px rgba(0, 0, 0, 0.25) inset;
        width: 100%;
        height: 500px;
        overflow: auto;
    }

    #cont_comentarios::-webkit-scrollbar {
        width: 8px;
    }

    #cont_comentarios::-webkit-scrollbar-thumb {
        background-color: #ffffff;
    }

    #cont_comentarios::-webkit-scrollbar-track {
        margin-top: 140px;
        margin-bottom: 35px;
        background-color: transparent;
    }

    #body {

        background-color: #F1F0EC;
    }
</style>
<html>

<head>
    <link rel="icon" href="{% static '/images/icono.png' %}" type="image/x-icon">

    <title>Harmony</title>
    <link rel="stylesheet" href="{% static '/css/pantalla_login.css' %}">
    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous">
    </script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://getbootstrap.com/docs/5.3/assets/css/docs.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>



    <script>
        function abrirModalComentario(idModal) {
            // Ocultar las modales anteriores (si las hay)
            $(".modal").modal("hide");

            // Mostrar la modal actual
            $("#" + idModal).modal("show");
        }

        function cerrarModalComentario(idModal) {
            // Ocultar la modal actual
            $("#" + idModal).modal("hide");
        }
        // Función para recargar la ventana después de un tiempo determinado
        function recargarPantalla() {
            setTimeout(function () {
                location.reload();
            }, 1000); // Recargar después de 1 segundo (puedes ajustar este valor según tus necesidades)
        }

        function previsualizarImagen(event) {
            var input = event.target;
            var imagen = document.getElementById('imagen_previa');

            if (input.files && input.files[0]) {
                var reader = new FileReader();

                reader.onload = function (e) {
                    imagen.src = e.target.result;
                    imagen.style.display = 'block';
                    foto_nueva.style.display = 'block';
                }

                reader.readAsDataURL(input.files[0]);
            } else {
                imagen.src = '#';
                imagen.style.display = 'none';
                foto_nueva.style.display = 'none';
            }
        }
    </script>
</head>

<body id="body">
    <div>
        <header>
            {% include 'navbar.html' %}
        </header>
        <main>
            <div class="container">
                <div class="row">
                    <div class="col-md-5" style="height: 100%; ">
                        <h1>{{ usuario_obj.nombre }} {{ usuario_obj.apellido }}</h1>
                        <img class="border rounded-circle border-1 border-dark" style="border-radius: 20px;"
                            src="{{usuario_obj.url_imagen_perfil}}" width="120px" height="120%">
                        <div id="info_user">

                            <div id="conText">
                                <h2>Correo:</h2>
                                <p>{{ usuario_obj.correo }}</p>
                            </div>
                            <div id="conText">
                                <h2>Fecha de nacimiento:</h2>
                                <p>{{usuario_obj.fecha_nacimiento|date:"d/m/Y"}}</p>
                            </div>
                            <div id="conText">
                                <h2>Genero:</h2>
                                {% if usuario_obj.genero == "H" %}
                                <p>Hombre</p>
                                {% else %}
                                <p>Mujer</p>
                                {% endif %}
                            </div>

                            <br>

                        </div>
                        <br>
                        <button class="btn btn-sm p-0 custom-button" id="boton_editar" data-bs-toggle="modal"
                            data-bs-target="#modalEditarUsuario{{ usuario_obj.id }}"
                            data-id-usuario="{{ usuario_obj.id }}">

                            <p id="text_button2">Editar perfil</p>
                        </button>
                    </div>
                    <div class="col-md-7" style="height: 100%;">
                        <h1>Tus Comentarios </h1>
                        <div id="cont_comentarios">
                            
                            {% include 'pantalla_foro/comentarios.html' %}

                        </div>


                    </div>
                </div>
        </main>
        <br>
        <footer></footer>
    </div>
    <!-- Ventana Modal Editar Usuario-->
    <div class="modal fade" id="modalEditarUsuario{{ usuario_id }}">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <!-- Encabezado de la ventana modal -->
                <div class="modal-header">
                    <h5 class="modal-title" id="modalAgregarComentarioLabel">Editar tu perfil</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <!-- Contenido principal del modal -->
                <div class="modal-body">
                    <!-- Formulario para editar el perfil -->
                    <form method="POST" action="{% url 'editar_usuario' usuario_id=usuario_id %}" enctype="multipart/form-data">
                        {% csrf_token %}
                        <div class="mb-3">
                            <label for="nombre" class="form-label">Nombre:</label>
                            <input type="text" class="form-control" id="nombre" name="nombre" value="{{ usuario_obj.nombre }}" placeholder="Nombre">
                        </div>
                        <div class="mb-3">
                            <label for="apellido" class="form-label">Apellido:</label>
                            <input type="text" class="form-control" id="apellido" name="apellido" value="{{ usuario_obj.apellido }}" placeholder="Apellido">
                        </div>
                        <div class="mb-3">
                            <label for="correo" class="form-label">Correo:</label>
                            <input type="email" class="form-control" id="correo" name="correo" value="{{ usuario_obj.correo }}" placeholder="Correo electrónico">
                        </div>
                        <div class="mb-3">
                            <label for="genero" class="form-label">Género:</label>
                            <select class="form-select" id="genero" name="genero">
                                {% if usuario_obj.genero == 'M' %}
                                <option value="H">Hombre</option>
                                <option value="M" selected>Mujer</option>
                                {% else %}
                                <option value="H" selected>Hombre</option>
                                <option value="M">Mujer</option>
                                {% endif %}
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="fechaNacido" class="form-label">Fecha de nacimiento:</label>
                            <input type="date" class="form-control" id="fechaNacido" name="fecha_nacimiento" value="{{ usuario_obj.fecha_nacimiento|date:'Y-m-d' }}">
                        </div>
                        <div class="mb-3">
                            <p>¿Deseas cambiar tu foto de perfil?</p>
                            <input type="file" id="nueva_imagen_perfil" name="nueva_imagen_perfil" onchange="previsualizarImagen(event)" accept="image/png, image/jpeg">
                        </div>
                        <div class="container">
                            <div class="row">
                                <div class="col-md-6">
                                    <p>Foto de perfil actual</p>
                                    <img src="{{ usuario_obj.url_imagen_perfil }}" style="border-radius: 40px; border: 2px solid black;" alt="Foto de perfil" class="img-fluid rounded-circle" width="100px" height="100px">
                                </div>
                                <div class="col-md-6">
                                    <p id="foto_nueva" style="display: none;">Foto de perfil actual</p>

                                    <img id="imagen_previa" src="#" alt="Previsualización" style="display: none;border-radius: 40px; border: 2px solid black;" class="img-fluid rounded-circle" width="100px" height="100px">
                                </div>
                            </div>
                        </div>
                        <br>
                        <div class="text-center">
                            <button type="submit" class="btn btn-primary">Guardar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    

    <!-- Ventana Modal Editar Comentario-->
    {% for comentario, _,_, id_comentario in comentarios %}
    <div class="modal fade" id="modalEditarComentario{{ id_comentario }}">
        <!-- Contenido de la ventana modal -->
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalAgregarComentarioLabel">Editar Comentario</h5>
                    <button type="button" class="btn-close"
                        onclick="cerrarModalComentario('modalEditarComentario{{ id_comentario }}')"
                        aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Formulario para editar el comentario -->
                    <form method="POST"
                        action="{% url 'editar_comentario' usuario_id=usuario_id comentario_id=id_comentario %}">
                        {% csrf_token %}
                        <input type="text" name="comentario" value="{{ comentario.comentario }}"
                            placeholder="Editar Comentario">
                        <button type="submit" class="btn btn-primary">Guardar</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
    <!-- Ventana Modal Borrar Comentario-->
    {% for comentario, _,_, id_comentario in comentarios %}
    <div class="modal fade" id="modalBorrarComentario{{ id_comentario }}">
        <!-- Contenido de la ventana modal -->
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalBorrarComentarioLabel">Borrar Comentario</h5>
                    <button type="button" class="btn-close"
                        onclick="cerrarModalComentario('modalBorrarComentarioLabel{{ id_comentario }}')"
                        aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Formulario para editar el comentario -->
                    <h1> ¿Estas seguro de borrar el comentario?</h1>
                    <form method="POST"
                        action="{% url 'borrar_comentario' usuario_id=usuario_id comentario_id=id_comentario %}">
                        {% csrf_token %}
                        <a class="dropdown-item">
                            <button type="submit" class="btn btn-sm p-0">Eliminar</button>
                        </a>
                    </form>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</body>

</html>