{% load static %}

<!DOCTYPE html>
<html>

<head>
    <link rel="icon" href="{% static '/images/icono.png' %}" type="image/x-icon">

    <title>Harmony</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://getbootstrap.com/docs/5.3/assets/css/docs.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous">
    </script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <style>
        .navbar-fixed {
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 999;
        }

        #body {
            background: linear-gradient(180deg, #6A638D 13.02%, #9485DE 80.21%);

        }

        #main {
            margin-top: 90px;
            margin-bottom: 100px;
            margin-left: 150px;
            padding-bottom: 80px;

        }

        #fondomain {
            background: linear-gradient(180deg, #6A638D 13.02%, #9485DE 80.21%);

        }




        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;

        }


        #botn_dropdown,
        #btn-enviar {
            border-radius: 29px;
            background: #424050;
            height: 100%;
            width: 100%;
        }

        #btn_enviar2 {
            border-radius: 29px;
            background: #424050;
            height: 100%;
            width: 70%;
        }

        .dropdown-item {
            position: relative;
            margin-top: 5px;
        }

        #container_like {
            margin-top: 5%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #container_like button,
        #container_like p {
            margin: 1px;
        }

        .mensaje {
            position: absolute;
            top: 0;
            left: 100%;
            white-space: nowrap;
            margin-left: 30px;
            display: none;
            background-color: #f9f9f9;
            padding: 5px;
            border: 1px solid #ccc;
        }

        .dropdown-item:hover {
            cursor: pointer;

        }

        .dropdown-item:hover .mensaje {
            display: block;
        }

        #cont_buscador_foro {

            width: 100%;
            height: 100%;
        }

        #cont_pregunta {
            border-radius: 17px;
            background: #D9D9D9;
            box-shadow: 0px 4px 4px 0px rgba(0, 0, 0, 0.25);
            width: 100%;
            margin-left: auto;
        }

        #user_nombre_pregunta {
            margin-top: 2%;
            margin-left: 5%;
            margin-bottom: 1%;
        }

        #user_pregunta {
            margin-left: 5%;
            margin-bottom: 2%;
        }

        #cont_respuesta {
            border-radius: 17px;
            background: #D9D9D9;
            box-shadow: 0px 4px 4px 0px rgba(0, 0, 0, 0.25);
            width: 60%;

        }

        #milly_nombre_respuesta {
            margin-top: 2%;
            margin-left: 3%;
        }

        #milly_respuesta {
            margin-left: 3%;
            margin-bottom: 2%;
        }

        #input_pregunta_foro,
        #input_pregunta {
            border-radius: 15px;
            background: #424050;
            width: 100%;
            border-color: transparent;
            color: white;

        }

        #input_pregunta_foro::placeholder,
        #input_pregunta::placeholder {

            color: white;
        }






        #contendor_no_hay_chat {
            display: grid;
            place-items: center;
        }

        #btn_nuevo_chat:hover+.mensaje {
            display: block;
        }

        #btn_nuevo_chat:hover {

            position: relative;
            margin-top: 5px;

        }

        #contenedor_footer {
            position: fixed;
            bottom: 0;
            background-color: transparent;
            margin-top: 1%;
            margin-bottom: 1%;

        }

        .dropdown-item {
            margin-top: 5px;
        }

        .dropdown-item:hover {
            cursor: pointer;

        }

        #cont_agregar_replica {

            margin-left: 5%;
            display: flex;
            align-items: center;
        }

        #openNav {
            position: fixed;
        }

        #mySidebar {
            position: fixed;

        }

        #replica {
            border-radius: 17px;
            background: #9FC5EB;
            box-shadow: 0px 4px 4px 0px rgba(0, 0, 0, 0.25);
            margin-left: 10%;
            width: 80%;
        }

        #contComentario {
            border-radius: 17px;
            background: #E9DEB3;
            box-shadow: 0px 4px 4px 0px rgba(0, 0, 0, 0.25);
        }

        #container_pregunta_foro {
            width: 50%;
            position: fixed;
            z-index: 999;
        }

        #ulti_footer {
            position: fixed;
            bottom: 0;
            width: 100%;
            margin: 1%;
        }

        #ulti_footer .container {
            display: flex;
            justify-content: center;
            /* Horizontally center the content */
        }

        .oculto {
            display: none;
        }

        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left: 4px solid #000000;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            margin: auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
    <script>
        function mostrarCarga() {
            var carga = document.getElementById("carga");
            carga.classList.remove("oculto");
            // Aquí podrías realizar alguna acción de envío o procesamiento
            // Simularemos un retraso con setTimeout para demostrar la animación
            setTimeout(function () {
                carga.classList.add("oculto");
            }, 3000); // Cambia 3000 por el tiempo real de tu proceso
        }

        $(document).ready(function () {

            var columnChat = document.getElementById('main');
            columnChat.scrollTop = columnChat.scrollHeight;
        });

        function w3_open() {
            //document.getElementById("main").style.marginLeft = "55%";
            //document.getElementById("mySidebar").style.width = "55%";
            document.getElementById("mySidebar").style.display = "block";
            document.getElementById("openNav").style.display = 'none';
        }

        function w3_close() {
            document.getElementById("main").style.marginLeft = "0%";
            document.getElementById("mySidebar").style.display = "none";
            document.getElementById("openNav").style.display = "inline-block";
        }

        document.addEventListener("DOMContentLoaded", function () {
            var container = document.getElementById('fondomain');
            container.scrollTop = container.scrollHeight;
        });
        window.onload = function () {
            location.href = "#final";
        };
    </script>



</head>

<body>
    <header class="navbar-fixed">
        {% include 'navbar.html' %}
    </header>


    <div style="display:none; width: 50%;height: 100vh; overflow-y: scroll; z-index: 9999; background-color: #9FC5EB;"
        id="mySidebar">
        <button onclick="w3_close()">Close &times;</button><br>
        <form method="GET" action="{% url 'pantalla_chatbot' usuario_id=usuario_id %}">
            {% csrf_token %}
            <div id="container_pregunta_foro" class="container">
                <div class="row">
                    <div class="col-9">
                        <input id="input_pregunta_foro" type="text" name="palabraBuscar" class="form-control"
                            placeholder="Buscar en el foro">
                    </div>
                    <div class="col-2">
                        <button id="btn_enviar2" type="submit">
                            <svg style="color: white;" xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                                <path
                                    d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </form>
        <br><br><br>
        <div id="comentarios_foro">
            {% include 'pantalla_foro/comentarios.html' %}
        </div>

        <br>
    </div>
    <main id="fondomain">
        <button id="openNav" class="w3-button w3-teal w3-xlarge" onclick="w3_open()">&#9776;</button>
        <div id="main">
            {% if conversaciones|length > 0 %}
            {% if conversacion|length > 0 %}
            {% for item in conversacion %}

            <div class="pregunta">
                <div class="container">
                    <div class="row">
                        <div class="col-md-7">
                            <div id="cont_pregunta">
                                <p id="user_nombre_pregunta"><b>{{nombre_usuario}}</b></p>
                                <p id="user_pregunta">{{ item.pregunta }}</p>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <img id="img" class="border rounded-circle border-1 border-dark"
                                style="border-radius: 50%; width: 50%; height: auto; float: left;"
                                src="{{url_imagen_perfil}}">
                        </div>
                    </div>

                </div>

            </div>
            <br>
            <div class="respuesta">
                <div class="container">
                    <div class="row">
                        <div class="col-md-2">
                            <img id="img" class="border rounded-circle border-1 border-dark"
                                style="border-radius: 50%; width: 50%; height: auto; float: right;"
                                src="{% static '/images/mily.png' %}">

                        </div>
                        <div class="col-md-7" id="cont_respuesta">
                            <p id="milly_nombre_respuesta"><b>Milly:</b>
                                <p>
                                    <p id="milly_respuesta">{{ item.respuesta }}</p>
                        </div>


                    </div>

                </div>

            </div>
            <br>
            {% endfor %}
            <a id="final"></a>

            {% else %}
            <p> no hay conversaciones</p>
            {% endif %}
            {% else %}
            <div id="contendor_no_hay_chat">
                <p> No hay conversaciones {{usuario_id}}</p>

                <form method="POST" action="{% url 'crearNuevoChat' usuario_id=usuario_id %}">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger">Nueva conversación</button>
                </form>


            </div>

            {% endif %}
        </div>
    </main>


    <footer id="ulti_footer">

        <div class="container">
            <div class="row" style=" width: 80%;">
                <div class="col-md-1">
                    <div class="dropdown">
                        <button id="botn_dropdown" type="button" class="btn-svg" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            <svg style="color: white;" xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                fill="currentColor" class="bi bi-gear-fill" viewBox="0 0 16 16">
                                <path
                                    d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872l-.1-.34zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z" />
                            </svg>
                        </button>
                        <ul class="dropdown-menu">
                            <!-- Enlaces del menú desplegable -->
                            <form method="POST" action="{% url 'crearNuevoChat' usuario_id=usuario_id %}">
                                {% csrf_token %}
                                <li>
                                    <button id="btn_nuevo_chat" class="dropdown-item" type="submit"
                                        class="btn btn-sm p-0">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                            fill="currentColor" class="bi bi-plus-circle-fill" viewBox="0 0 16 16">
                                            <path
                                                d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8.5 4.5a.5.5 0 0 0-1 0v3h-3a.5.5 0 0 0 0 1h3v3a.5.5 0 0 0 1 0v-3h3a.5.5 0 0 0 0-1h-3v-3z" />
                                        </svg>
                                    </button>
                                    <span class="mensaje">Nuevo chat</span>
                                </li>
                            </form>
                            <li>
                                <a class="dropdown-item" id="boton_limpiar_chat">
                                    <button type="submit" name="boton_limpiar_chat" value="borrar"
                                        class="btn btn-sm p-0">
                                        <svg style="color: black;" xmlns="http://www.w3.org/2000/svg" width="25%"
                                            height="25%" fill="white" class="bi bi-trash-fill" viewBox="0 0 16 16">
                                            <path
                                                d="M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1H2.5zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5zM8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7A.5.5 0 0 1 8 5zm3 .5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 1 0z" />
                                        </svg>
                                    </button>
                                    <span class="mensaje">Vaciar chat</span>
                                </a>
                            </li>
                        </ul>
                    </div>

                </div>
                <div class=" col-md-10">
                    <form method="POST"
                        action="{% url 'enviarMensajeChatBot' usuario_id=usuario_id posicion=posicion %}">
                        {% csrf_token %}
                        <div class="container">
                            <div class="row" style="width: 100%;">
                                <div class="col-md-10">
                                    <input id="input_pregunta" type="text" name="pregunta" class="form-control"
                                        placeholder="Ingresa tu pregunta">
                                </div>
                                <div class="col-md-2">
                                    <div id="carga" class="oculto">
                                        <div class="spinner"></div>
                                    </div>
                                    <button type="submit" id="btn-enviar" onclick="mostrarCarga()">
                                        <svg style="color: white;" xmlns="http://www.w3.org/2000/svg" width="16"
                                            height="16" fill="currentColor" class="bi bi-send-fill" viewBox="0 0 16 16">
                                            <path
                                                d="M15.964.686a.5.5 0 0 0-.65-.65L.767 5.855H.766l-.452.18a.5.5 0 0 0-.082.887l.41.26.001.002 4.995 3.178 3.178 4.995.002.002.26.41a.5.5 0 0 0 .886-.083l6-15Zm-1.833 1.89L6.637 10.07l-.215-.338a.5.5 0 0 0-.154-.154l-.338-.215 7.494-7.494 1.178-.471-.47 1.178Z" />
                                        </svg>
                                    </button>

                                    <script>
                                        var input = document.getElementById("input_pregunta");
                                        input.addEventListener("keypress", function (event) {
                                            if (event.key === "Enter") {
                                                event.preventDefault();
                                                document.getElementById("btn-enviar")
                                                    .click();
                                            }
                                        });
                                    </script>

                                </div>
                            </div>
                        </div>
                    </form>
                </div>

            </div>
        </div>
    </footer>

</body>

</html>